{% extends 'base.html' %}

{% block more-style %}

{% endblock %}

{% block body-content %}

<div class="container-fluid">
  <div class="row text-center salmon-color">
    <h1>Distributed Code Editor</h1>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8" id="codebox">
      <textarea id="myTextarea"></textarea>
    </div>
  </div>
  <div class="text-center">
    <button type="button" class="btn btn-salmon" id="update">Update to server</button>
    <button type="button" class="btn btn-salmon" id="fetch">Fetch latest from server</button>
  </div>
</div>
{% endblock %}

{% block morescript %}
<!-- Create a simple CodeMirror instance -->
<link rel="stylesheet" href="codemirror-5.8/lib/codemirror.css">
<link rel="stylesheet" href="codemirror-5.8/theme/dracula.css">
<script src="codemirror-5.8/lib/codemirror.js"></script>
<script src="codemirror-5.8/mode/javascript/javascript.js"></script>
<script>
  var editor = CodeMirror.fromTextArea(myTextarea, {
    lineNumbers: true,
    mode: "javascript",
    matchBrackets: true,
    theme: "dracula"
  });
</script>
<script type="text/javascript">
  $(document).ready(function(){
    $("#fetch").on("click", function(){
      $.ajax({
        url: "/mycode",
        context: document.body
      }).done(function(doc) {
        editor.doc.setValue(doc);
      });
    });
    $("#update").on("click", function(){
      var datum = editor.doc.getValue();
      console.log(datum);
      $.post("/mycode", {"codedata": datum});
    });
  });
</script>
{% endblock %}